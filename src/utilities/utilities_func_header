#!/bin/sh
# Copyright (c) 1998 Lawrence Livermore National Security, LLC and other
# HYPRE Project Developers. See the top-level COPYRIGHT file for details.
#
# SPDX-License-Identifier: (Apache-2.0 OR MIT)

# generate header file for transforming multiprecision function names

MUP_HEADER=utilities_mup_func.h

cat > $MUP_HEADER <<@
/*** DO NOT EDIT THIS FILE DIRECTLY (use 'mup_func_header' to generate) ***/
@
# Generate copyright header
../../../hypre/src/scripts/writeHeader.sh $MUP_HEADER

cat >> $MUP_HEADER <<@

/******************************************************************************
 * Header file for transforming multiprecision functions names
 *****************************************************************************/

#ifndef UTILITIES_MUP_FUNC_HEADER
#define UTILITIES_MUP_FUNC_HEADER

#include "HYPRE_utilities.h"

@

FIN=utilities_functions.saved
cat>> $MUP_HEADER <<@
$(
cat "$FIN" | while read -r f
do
#echo "$f"
# get filename, function name, and pattern to search for
fname="$(echo $f | awk -F'[.]' '{print $1".c"}')"

# strip leading underscore
#func_name="$(echo $f | awk -F'[:]' '{gsub(/ _/,""); print $2}')"
func_name="$(echo $f | awk -F'[" "]' '{p_str=substr($2,2); print p_str}')"

# search filename for pattern and dress function name
p_string="#define $func_name HYPRE_MULTIPRECISION_FUNC ( $func_name )"
#echo "$p_string"
awk -v pat="$func_name" -v pat2="$p_string" '/BUILD_MP_FUNC/{flag=1; next} /{/{flag=0} $0~pat && flag{print pat2; exit}' "$fname"
done
)

#endif
@